{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/savas/Downloads/agenttest/EylulSanatWeb/src/lib/session.ts"],"sourcesContent":["import 'server-only';\r\nimport { SignJWT, jwtVerify } from 'jose';\r\nimport { cookies } from 'next/headers';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst logFile = path.join(process.cwd(), 'session-debug.log');\r\nfunction log(msg: string) {\r\n    try {\r\n        const timestamp = new Date().toISOString();\r\n        fs.appendFileSync(logFile, `${timestamp}: ${msg}\\n`);\r\n    } catch (e) {\r\n        // ignore\r\n    }\r\n}\r\n\r\nconst secretKey = process.env.SESSION_SECRET || 'default_secret_key_change_me_in_production';\r\nconst encodedKey = new TextEncoder().encode(secretKey);\r\n\r\nexport async function encrypt(payload: any) {\r\n    return new SignJWT(payload)\r\n        .setProtectedHeader({ alg: 'HS256' })\r\n        .setIssuedAt()\r\n        .setExpirationTime('7d')\r\n        .sign(encodedKey);\r\n}\r\n\r\nexport async function decrypt(session: string | undefined = '') {\r\n    try {\r\n        const { payload } = await jwtVerify(session, encodedKey, {\r\n            algorithms: ['HS256'],\r\n        });\r\n        return payload;\r\n    } catch (error: any) {\r\n        log(`Decrypt failed: ${error.message}`);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function createSession() {\r\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\r\n    const session = await encrypt({ role: 'admin', expiresAt });\r\n    const cookieStore = await cookies();\r\n\r\n    log(`Creating session. Cookie set. Expires: ${expiresAt}`);\r\n\r\n    cookieStore.set('session', session, {\r\n        httpOnly: true,\r\n        secure: false, // Debugging: Relax security to rule out SSL mix-ups\r\n        expires: expiresAt,\r\n        sameSite: 'lax',\r\n        path: '/',\r\n    });\r\n}\r\n\r\nexport async function verifySession() {\r\n    const cookieStore = await cookies();\r\n    const session = cookieStore.get('session')?.value;\r\n\r\n    if (!session) {\r\n        log('Verify: No session cookie found');\r\n        return null;\r\n    }\r\n\r\n    const payload = await decrypt(session);\r\n\r\n    if (!payload) {\r\n        log('Verify: Payload decryption failed');\r\n        return null;\r\n    }\r\n\r\n    log('Verify: Success');\r\n    return { isAuth: true };\r\n}\r\n\r\nexport async function deleteSession() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete('session');\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,SAAS,IAAI,GAAW;IACpB,IAAI;QACA,MAAM,YAAY,IAAI,OAAO,WAAW;QACxC,wGAAE,CAAC,cAAc,CAAC,SAAS,GAAG,UAAU,EAAE,EAAE,IAAI,EAAE,CAAC;IACvD,EAAE,OAAO,GAAG;IACR,SAAS;IACb;AACJ;AAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,cAAc,IAAI;AAChD,MAAM,aAAa,IAAI,cAAc,MAAM,CAAC;AAErC,eAAe,QAAQ,OAAY;IACtC,OAAO,IAAI,gKAAO,CAAC,SACd,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,MAClB,IAAI,CAAC;AACd;AAEO,eAAe,QAAQ,UAA8B,EAAE;IAC1D,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAA,oKAAS,EAAC,SAAS,YAAY;YACrD,YAAY;gBAAC;aAAQ;QACzB;QACA,OAAO;IACX,EAAE,OAAO,OAAY;QACjB,IAAI,CAAC,gBAAgB,EAAE,MAAM,OAAO,EAAE;QACtC,OAAO;IACX;AACJ;AAEO,eAAe;IAClB,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,KAAK;IAC3D,MAAM,UAAU,MAAM,QAAQ;QAAE,MAAM;QAAS;IAAU;IACzD,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,IAAI,CAAC,uCAAuC,EAAE,WAAW;IAEzD,YAAY,GAAG,CAAC,WAAW,SAAS;QAChC,UAAU;QACV,QAAQ;QACR,SAAS;QACT,UAAU;QACV,MAAM;IACV;AACJ;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,MAAM,UAAU,YAAY,GAAG,CAAC,YAAY;IAE5C,IAAI,CAAC,SAAS;QACV,IAAI;QACJ,OAAO;IACX;IAEA,MAAM,UAAU,MAAM,QAAQ;IAE9B,IAAI,CAAC,SAAS;QACV,IAAI;QACJ,OAAO;IACX;IAEA,IAAI;IACJ,OAAO;QAAE,QAAQ;IAAK;AAC1B;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACvB"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/savas/Downloads/agenttest/EylulSanatWeb/src/actions/auth.ts"],"sourcesContent":["'use server';\r\n\r\nimport bcrypt from 'bcryptjs';\r\nimport { createSession, deleteSession } from '@/lib/session';\r\nimport { redirect } from 'next/navigation';\r\nimport { db } from '@/lib/json-db';\r\n\r\nexport async function login(formData: FormData) {\r\n    const password = formData.get('password') as string;\r\n    const settings = await db.settings.get();\r\n    const storedHash = settings.adminPasswordHash || process.env.ADMIN_PASSWORD_HASH;\r\n\r\n    if (!storedHash) {\r\n        throw new Error('Admin password hash is not set');\r\n    }\r\n\r\n    // Development bypass ensures you can login locally easily\r\n    // In production, this block is automatically skipped\r\n    if (process.env.NODE_ENV !== 'production' && password === 'admin123') {\r\n        await createSession();\r\n        redirect('/admin');\r\n    }\r\n\r\n    const isValid = await bcrypt.compare(password, storedHash);\r\n\r\n    if (!isValid) {\r\n        return { error: 'Hatalı şifre.' };\r\n    }\r\n\r\n    await createSession();\r\n    redirect('/admin');\r\n}\r\n\r\nexport async function logout() {\r\n    await deleteSession();\r\n    redirect('/');\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AAAA;AACA;;;;;;;AAEO,eAAe,MAAM,QAAkB;IAC1C,MAAM,WAAW,SAAS,GAAG,CAAC;IAC9B,MAAM,WAAW,MAAM,8HAAE,CAAC,QAAQ,CAAC,GAAG;IACtC,MAAM,aAAa,SAAS,iBAAiB,IAAI,QAAQ,GAAG,CAAC,mBAAmB;IAEhF,IAAI,CAAC,YAAY;QACb,MAAM,IAAI,MAAM;IACpB;IAEA,0DAA0D;IAC1D,qDAAqD;IACrD,IAAI,oDAAyB,gBAAgB,aAAa,YAAY;QAClE,MAAM,IAAA,sIAAa;QACnB,IAAA,iMAAQ,EAAC;IACb;IAEA,MAAM,UAAU,MAAM,4IAAM,CAAC,OAAO,CAAC,UAAU;IAE/C,IAAI,CAAC,SAAS;QACV,OAAO;YAAE,OAAO;QAAgB;IACpC;IAEA,MAAM,IAAA,sIAAa;IACnB,IAAA,iMAAQ,EAAC;AACb;AAEO,eAAe;IAClB,MAAM,IAAA,sIAAa;IACnB,IAAA,iMAAQ,EAAC;AACb;;;IA7BsB;IA0BA;;AA1BA,+OAAA;AA0BA,+OAAA"}},
    {"offset": {"line": 164, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/savas/Downloads/agenttest/EylulSanatWeb/.next-internal/server/app/admin/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {login as '403deb8b9b2d5b9baa3e45b2c6ba170e7f053f9bc1'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}