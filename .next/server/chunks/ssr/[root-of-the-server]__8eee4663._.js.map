{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../src/actions/upload.ts","../../../../.next-internal/server/app/admin/%28dashboard%29/settings/page/actions.js%20%28server%20actions%20loader%29","../../../../src/actions/settings.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server';\r\n\r\nimport { writeFile, mkdir } from 'fs/promises';\r\nimport { join } from 'path';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport async function uploadImage(formData: FormData) {\r\n    const file = formData.get('file') as File;\r\n    if (!file) {\r\n        throw new Error('Dosya seçilmedi');\r\n    }\r\n\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n\r\n    // Allow only images\r\n    if (!file.type.startsWith('image/')) {\r\n        throw new Error('Sadece resim dosyaları yüklenebilir');\r\n    }\r\n\r\n    const uniqueSuffix = uuidv4();\r\n    const originalName = file.name.replace(/\\.[^/.]+$/, \"\").replace(/[^a-z0-9]/gi, '_').toLowerCase();\r\n    const ext = file.name.split('.').pop();\r\n    const filename = `${originalName}-${uniqueSuffix}.${ext}`;\r\n\r\n    const uploadDir = join(process.cwd(), 'public', 'uploads');\r\n\r\n    // Ensure directory exists\r\n    try {\r\n        await mkdir(uploadDir, { recursive: true });\r\n    } catch (e) {\r\n        // ignore\r\n    }\r\n\r\n    const filepath = join(uploadDir, filename);\r\n    await writeFile(filepath, buffer);\r\n\r\n    return `/uploads/${filename}`;\r\n}\r\n","export {logout as '0045e9b9d28bc56362bae83ded660aa300f0f050e3'} from 'ACTIONS_MODULE0'\nexport {updateSettings as '40e4c6be0150d7a8ff14820fb96ca6a93d80bfb85b'} from 'ACTIONS_MODULE1'\nexport {updatePassword as '4038912dd685217060e6a55e4e54d934578da30ddd'} from 'ACTIONS_MODULE1'\nexport {uploadImage as '40f282f1b7f6ba2f9131f89b460fc154dd7302e6d3'} from 'ACTIONS_MODULE2'\n","'use server';\r\n\r\nimport { db } from '@/lib/json-db';\r\nimport { Settings } from '@/types';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nimport bcrypt from 'bcryptjs';\r\n\r\nexport async function updateSettings(formData: FormData) {\r\n    const currentSettings = await db.settings.get();\r\n\r\n    const settings: Settings = {\r\n        siteTitle: formData.get('siteTitle') as string,\r\n        siteDescription: formData.get('siteDescription') as string,\r\n        contact: {\r\n            phone: formData.get('phone') as string,\r\n            email: formData.get('email') as string,\r\n            address: formData.get('address') as string,\r\n            mapUrl: formData.get('mapUrl') as string,\r\n        },\r\n        socials: {\r\n            instagram: formData.get('instagram') as string,\r\n            facebook: formData.get('facebook') as string,\r\n            youtube: formData.get('youtube') as string,\r\n        },\r\n        features: {\r\n            maintenanceMode: formData.get('maintenanceMode') === 'on', // 'on' = açık, 'off' veya null = kapalı\r\n        },\r\n        hero: {\r\n            title: formData.get('heroTitle') as string,\r\n            subtitle: formData.get('heroSubtitle') as string,\r\n            image: formData.get('heroImage') as string,\r\n        },\r\n        about: {\r\n            title: formData.get('aboutTitle') as string,\r\n            description: formData.get('aboutDescription') as string,\r\n            image: formData.get('aboutImage') as string,\r\n        },\r\n        whyUs: {\r\n            title: formData.get('whyUsTitle') as string,\r\n            items: (formData.get('whyUsItems') as string || '').split('\\n').filter(Boolean).map(item => item.trim()),\r\n        },\r\n        logo: formData.get('logo') as string,\r\n        adminPasswordHash: currentSettings.adminPasswordHash // Şifreyi koru\r\n    };\r\n\r\n    await db.settings.update(settings);\r\n    revalidatePath('/', 'layout');\r\n    revalidatePath('/admin/settings');\r\n}\r\n\r\nexport async function updatePassword(formData: FormData) {\r\n    const currentPassword = formData.get('currentPassword') as string;\r\n    const newPassword = formData.get('newPassword') as string;\r\n    const confirmPassword = formData.get('confirmPassword') as string;\r\n\r\n    if (!currentPassword || !newPassword || !confirmPassword) {\r\n        return { error: 'Lütfen tüm alanları doldurun.' };\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n        return { error: 'Yeni şifreler eşleşmiyor.' };\r\n    }\r\n\r\n    const settings = await db.settings.get();\r\n    const storedHash = settings.adminPasswordHash || process.env.ADMIN_PASSWORD_HASH;\r\n\r\n    if (!storedHash) {\r\n        return { error: 'Sistem hatası: Şifre kaydı bulunamadı.' };\r\n    }\r\n\r\n    const isValid = await bcrypt.compare(currentPassword, storedHash);\r\n    if (!isValid) {\r\n        return { error: 'Mevcut şifre hatalı.' };\r\n    }\r\n\r\n    const newHash = await bcrypt.hash(newPassword, 10);\r\n\r\n    const updatedSettings = {\r\n        ...settings,\r\n        adminPasswordHash: newHash\r\n    };\r\n\r\n    await db.settings.update(updatedSettings);\r\n    revalidatePath('/admin/settings');\r\n\r\n    return { success: true };\r\n}\r\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}